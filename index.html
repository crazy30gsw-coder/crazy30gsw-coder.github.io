<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é€Ÿå ±ã¾ã¨ã‚ | Boat Picks</title>
  <meta name="description" content="RSSã‹ã‚‰è‡ªå‹•åé›†ã—ãŸé€Ÿå ±ã¾ã¨ã‚ã€‚è¦‹å‡ºã—ä¸­å¿ƒã§ã‚µã‚¯ãƒƒã¨èª­ã‚€ã€‚" />
  <meta name="theme-color" content="#111827" />
  <style>
    :root{
      --bg:#0b1020;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.10);
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.60);
      --muted2:rgba(255,255,255,.45);
      --accent:#f59e0b; /* é€Ÿå ±æ„Ÿ */
      --accent2:#60a5fa;
      --danger:#fb7185;
      --shadow:0 14px 44px rgba(0,0,0,.40);
      --r16:16px;
      --r24:24px;
      --max:1100px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb;
        --panel:rgba(0,0,0,.04);
        --panel2:rgba(0,0,0,.06);
        --line:rgba(0,0,0,.10);
        --text:rgba(0,0,0,.88);
        --muted:rgba(0,0,0,.58);
        --muted2:rgba(0,0,0,.46);
        --shadow:0 14px 44px rgba(0,0,0,.12);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Sans", "Yu Gothic", "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 520px at 10% -10%, rgba(245,158,11,.25), transparent 60%),
        radial-gradient(1000px 520px at 90% 0%, rgba(96,165,250,.18), transparent 60%),
        radial-gradient(900px 560px at 50% 110%, rgba(251,113,133,.12), transparent 60%),
        var(--bg);
    }
    a{color:inherit; text-decoration:none}

    /* ===== Header ===== */
    .top{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(10,15,30,.82), rgba(10,15,30,.45));
      border-bottom:1px solid var(--line);
    }
    @media (prefers-color-scheme: light){
      .top{background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));}
    }
    .top-inner{
      max-width:var(--max); margin:0 auto;
      padding:12px 12px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
    }
    .mark{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg, rgba(245,158,11,.95), rgba(251,113,133,.85));
      box-shadow: 0 10px 30px rgba(245,158,11,.18);
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.12);
      flex:0 0 auto;
    }
    .brand h1{
      margin:0; font-size:18px; line-height:1.1;
      letter-spacing:.02em;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 44vw;
    }
    .brand .sub{
      margin-top:2px; font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 44vw;
    }
    .right{
      display:flex; align-items:center; gap:10px; flex:0 0 auto;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      box-shadow: var(--shadow);
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .pill .dot{width:8px; height:8px; border-radius:999px; background: var(--accent)}
    .pill.secondary .dot{background: var(--accent2)}
    .pill small{color:var(--muted); font-size:12px}

    /* ===== Layout ===== */
    .wrap{max-width:var(--max); margin:0 auto; padding:14px 12px 70px}
    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .search{
      flex: 1 1 320px;
      display:flex; gap:10px; align-items:center;
      padding:12px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
    }
    @media (prefers-color-scheme: light){
      .search{background: rgba(255,255,255,.72)}
    }
    .search input{
      width:100%;
      border:none; outline:none; background:transparent;
      color:var(--text); font-size:15px;
    }
    .search input::placeholder{color:var(--muted2)}

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .tab[aria-pressed="true"]{
      border-color: rgba(245,158,11,.55);
      box-shadow: 0 0 0 3px rgba(245,158,11,.18);
    }
    .meta{
      margin-top:10px;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:13px;
    }

    /* ===== Main Grid ===== */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 920px){
      .grid{grid-template-columns: 1.6fr 1fr;}
    }
    .panel{
      border:1px solid var(--line);
      border-radius: var(--r24);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-title{
      padding:14px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .panel-title h2{
      margin:0; font-size:16px; letter-spacing:.02em;
      display:flex; align-items:center; gap:10px;
    }
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      color:var(--muted);
    }
    @media (prefers-color-scheme: light){
      .tag{background: rgba(255,255,255,.75)}
    }

    /* ===== Cards ===== */
    .list{padding:12px}
    .card{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:12px;
      padding:12px;
      border-radius: var(--r16);
      border:1px solid var(--line);
      background: rgba(0,0,0,.08);
      transition: transform .12s ease, border-color .12s ease;
    }
    @media (prefers-color-scheme: light){
      .card{background: rgba(255,255,255,.72)}
    }
    .card:hover{transform: translateY(-2px); border-color: rgba(245,158,11,.35)}
    .thumb{
      width:100%;
      aspect-ratio: 16/10;
      border-radius: 14px;
      overflow:hidden;
      display:block;
      border:1px solid rgba(255,255,255,.10);
      background:#111827;
    }
    .title{
      margin:0;
      font-size:15px;
      line-height:1.35;
      letter-spacing:.01em;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .subrow{
      margin-top:8px;
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:12.5px;
    }
    .src{
      display:inline-flex; align-items:center; gap:8px; min-width:0;
    }
    .src span{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 240px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      color:var(--muted);
    }
    @media (prefers-color-scheme: light){
      .badge{background: rgba(255,255,255,.75)}
    }

    /* ===== Hot list ===== */
    .rank{
      padding:10px 12px 14px;
    }
    .rankItem{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius: var(--r16);
      border:1px solid var(--line);
      background: rgba(0,0,0,.08);
    }
    @media (prefers-color-scheme: light){
      .rankItem{background: rgba(255,255,255,.72)}
    }
    .rankNo{
      width:30px; height:30px; border-radius: 12px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(245,158,11,.95), rgba(96,165,250,.75));
      color:white; font-weight:800;
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.12);
    }
    .rankTitle{
      margin:0;
      font-size:13.5px;
      line-height:1.35;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    .footer{
      margin-top:14px;
      display:flex; justify-content:center; gap:10px; flex-wrap:wrap;
    }
    .more{
      padding:12px 16px;
      border-radius:999px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      box-shadow: var(--shadow);
      cursor:pointer;
      font-size:14px;
      color:var(--text);
    }
    .more:disabled{opacity:.55; cursor:not-allowed}

    .empty{
      margin-top:12px;
      padding:18px 16px;
      border-radius: var(--r24);
      border:1px dashed var(--line);
      color:var(--muted);
      text-align:center;
      background: rgba(0,0,0,.08);
    }
    @media (prefers-color-scheme: light){
      .empty{background: rgba(255,255,255,.72)}
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="top">
    <div class="top-inner">
      <div class="brand">
        <div class="mark" aria-hidden="true">ğŸ“°</div>
        <div style="min-width:0">
          <h1>é€Ÿå ±ã¾ã¨ã‚</h1>
          <div class="sub" id="subline">RSSè‡ªå‹•åé›†ï¼ˆèª­ã¿å–ã‚Šç”¨ï¼‰</div>
        </div>
      </div>

      <div class="right">
        <button class="pill" id="reloadBtn" type="button" title="posts.jsonã‚’å†èª­ã¿è¾¼ã¿">
          <span class="dot" aria-hidden="true"></span>
          æ›´æ–°
          <small id="countMini">â€”</small>
        </button>
        <a class="pill secondary" href="https://github.com/crazy30gsw-coder" target="_blank" rel="noopener">
          <span class="dot" aria-hidden="true"></span>
          GitHub
          <small>ç·¨é›†</small>
        </a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="search" role="search">
        ğŸ” <input id="q" type="search" placeholder="æ¤œç´¢ï¼ˆä¾‹ï¼šG1ã€èŠ¦å±‹ã€ä½ä¹‹æ±Ÿã€å³°ã€äº‹æ•…â€¦ï¼‰" autocomplete="off">
      </div>
      <div class="tabs" aria-label="ã‚«ãƒ†ã‚´ãƒª">
        <button class="tab" data-tab="all" aria-pressed="true">å…¨éƒ¨</button>
        <button class="tab" data-tab="g1" aria-pressed="false">G1</button>
        <button class="tab" data-tab="race" aria-pressed="false">ãƒ¬ãƒ¼ã‚¹</button>
        <button class="tab" data-tab="pro" aria-pressed="false">é¸æ‰‹</button>
        <button class="tab" data-tab="ent" aria-pressed="false">è©±é¡Œ</button>
        <button class="tab" data-tab="other" aria-pressed="false">ãã®ä»–</button>
      </div>
    </div>

    <div class="meta">
      <div id="status">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
      <div id="updated">â€”</div>
    </div>

    <!-- Main -->
    <div class="grid">
      <!-- Left: Latest -->
      <section class="panel">
        <div class="panel-title">
          <h2>ğŸ”¥ æœ€æ–°é€Ÿå ±</h2>
          <span class="tag" id="filterTag">ALL</span>
        </div>
        <div class="list" id="list"></div>
      </section>

      <!-- Right: Hot Rank -->
      <aside class="panel">
        <div class="panel-title">
          <h2>ğŸ“ˆ ä»Šæ—¥ã®æ³¨ç›®</h2>
          <span class="tag">Hot</span>
        </div>
        <div class="rank" id="rank"></div>
      </aside>
    </div>

    <div id="empty" class="empty" style="display:none;">è©²å½“ã™ã‚‹è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>

    <div class="footer">
      <button class="more" id="moreBtn" type="button">ã‚‚ã£ã¨è¦‹ã‚‹</button>
    </div>
  </div>

<script>
(() => {
  const POSTS_URL = './posts.json';
  const PAGE_SIZE = 10;

  const $ = (id) => document.getElementById(id);
  const list = $('list');
  const rank = $('rank');
  const empty = $('empty');
  const status = $('status');
  const updated = $('updated');
  const subline = $('subline');
  const countMini = $('countMini');
  const reloadBtn = $('reloadBtn');
  const moreBtn = $('moreBtn');
  const q = $('q');
  const filterTag = $('filterTag');

  const tabs = Array.from(document.querySelectorAll('.tab'));

  let all = [];
  let view = [];
  let cursor = 0;
  let tab = 'all';

  // ===== utils =====
  const safeDate = (iso) => {
    const d = new Date(iso);
    return isNaN(d.getTime()) ? null : d;
  };
  const pad = (n) => String(n).padStart(2,'0');
  const fmtJP = (d) => `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  const relTime = (d) => {
    const diff = Date.now() - d.getTime();
    const sec = Math.floor(diff/1000);
    if(sec < 60) return `${sec}ç§’å‰`;
    const min = Math.floor(sec/60);
    if(min < 60) return `${min}åˆ†å‰`;
    const hr = Math.floor(min/60);
    if(hr < 48) return `${hr}æ™‚é–“å‰`;
    const day = Math.floor(hr/24);
    return `${day}æ—¥å‰`;
  };
  const domainFromUrl = (u) => {
    try { return new URL(u).hostname.replace(/^www\./,''); } catch { return ''; }
  };
  const favicon = (domain) => domain ? `https://www.google.com/s2/favicons?sz=64&domain=${encodeURIComponent(domain)}` : '';

  const escapeHtml = (s) => String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;').replace(/'/g,'&#039;');

  // ã‚µãƒ ãƒï¼ˆå¤–éƒ¨ç”»åƒãªã—ã§â€œç”»åƒä»˜ãæ„Ÿâ€ï¼‰
  const hashStr = (s) => {
    let h=2166136261;
    for(let i=0;i<s.length;i++){ h ^= s.charCodeAt(i); h = Math.imul(h, 16777619); }
    return (h>>>0);
  };
  const thumbSVG = (seedText, title) => {
    const h = hashStr(seedText);
    const a = (h % 360), b = ((h>>8) % 360), c = ((h>>16) % 360);
    const bg1 = `hsl(${a} 85% 55%)`;
    const bg2 = `hsl(${b} 75% 45%)`;
    const bg3 = `hsl(${c} 70% 50%)`;
    const t = (title || '').trim().slice(0, 44);
    const safe = escapeHtml(t);

    const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500" viewBox="0 0 800 500">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${bg1}" stop-opacity="0.98"/>
      <stop offset="0.55" stop-color="${bg2}" stop-opacity="0.92"/>
      <stop offset="1" stop-color="${bg3}" stop-opacity="0.92"/>
    </linearGradient>
    <filter id="blur" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="20"/>
    </filter>
  </defs>
  <rect width="800" height="500" fill="url(#g)"/>
  <circle cx="120" cy="120" r="120" fill="rgba(255,255,255,.18)" filter="url(#blur)"/>
  <circle cx="700" cy="90" r="140" fill="rgba(0,0,0,.12)" filter="url(#blur)"/>
  <circle cx="620" cy="420" r="190" fill="rgba(255,255,255,.14)" filter="url(#blur)"/>
  <rect x="28" y="324" width="744" height="144" rx="22" fill="rgba(0,0,0,.30)"/>
  <text x="52" y="374" font-size="28" font-family="ui-sans-serif,system-ui" fill="rgba(255,255,255,.94)">${safe}</text>
  <text x="52" y="416" font-size="18" font-family="ui-sans-serif,system-ui" fill="rgba(255,255,255,.78)">é€Ÿå ±ã¾ã¨ã‚ â€¢ Boat Picks</text>
</svg>`.trim();

    return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
  };

  // ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªè‡ªå‹•åˆ¤å®šï¼ˆposts.jsonã«ã‚«ãƒ†ã‚´ãƒªãŒç„¡ãã¦ã‚‚OKï¼‰
  const detectCat = (title) => {
    const t = (title || '').toLowerCase();
    if(/g1|ã‚°ãƒ©ãƒ³ãƒ—ãƒª|sg|g2|g3/.test(t)) return 'g1';
    if(/ä½ä¹‹æ±Ÿ|èŠ¦å±‹|å¤šæ‘©å·|å¹³å’Œå³¶|è’²éƒ¡|ç¦å²¡|æˆ¸ç”°|æ±Ÿæˆ¸å·|ã³ã‚ã“|å°¼å´|ä¸¸äº€|è‹¥æ¾|æ¡ç”Ÿ|ä¸‰å›½/.test(title)) return 'race';
    if(/é¸æ‰‹|è—¤æ£®|å³°|é¦¬å ´|æ¯’å³¶|çŸ³é‡|ç“œç”Ÿ|å®ˆç”°|èŒ…åŸ|æ¡ç”Ÿé †å¹³|è¥¿å±±/.test(title)) return 'pro';
    if(/èŠ¸èƒ½|abema|çµå©š|ç‚ä¸Š|å†™çœŸ|ãƒ‰ãƒ©ãƒ|ãƒ†ãƒ¬ãƒ“|è©±é¡Œ/.test(t)) return 'ent';
    return 'other';
  };

  const normalize = (arr) => {
    const out = [];
    for(const p of (arr || [])){
      const id = String(p.id ?? '');
      const title = String(p.title ?? '').trim();
      const link = String(p.link ?? '').trim();
      const sourceUrl = String(p.sourceUrl ?? '').trim();
      const d = safeDate(p.date);
      if(!id || !title || !link || !d) continue;
      const domain = domainFromUrl(sourceUrl);
      out.push({ id, title, link, sourceUrl, date:d, domain, cat: detectCat(title) });
    }
    out.sort((a,b)=>b.date - a.date);
    return out;
  };

  // â€œHotâ€ã£ã½ã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆç°¡æ˜“ï¼šé®®åº¦ï¼‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã‚¹ã‚³ã‚¢ï¼‰
  const scoreHot = (p) => {
    const hours = (Date.now() - p.date.getTime()) / 3600000;
    let s = Math.max(0, 48 - hours); // 48hä»¥å†…ãŒå¼·ã„
    if(/g1|sg|å„ªå‹|äº‹æ•…|ç‚ä¸Š|è¡æ’ƒ|ä¸å€«|é€®æ•|å†™çœŸ/.test(p.title.toLowerCase())) s += 12;
    if(p.cat === 'g1') s += 6;
    return s;
  };

  const renderCard = (p) => {
    const dt = fmtJP(p.date);
    const rel = relTime(p.date);
    const dom = p.domain || 'source';
    const fav = favicon(dom);
    const thumb = thumbSVG(p.id + p.title, p.title);

    return `
      <a class="card" href="${p.link}" aria-label="${escapeHtml(p.title)}">
        <img class="thumb" src="${thumb}" alt="" loading="lazy" decoding="async">
        <div>
          <p class="title">${escapeHtml(p.title)}</p>
          <div class="subrow">
            <div class="src">
              ${fav ? `<img src="${fav}" width="16" height="16" alt="" style="border-radius:4px;opacity:.95">` : ''}
              <span title="${escapeHtml(dom)}">${escapeHtml(dom)}</span>
              <span class="badge" title="${escapeHtml(dt)}">${escapeHtml(rel)}</span>
            </div>
            <span title="${escapeHtml(dt)}">${escapeHtml(dt.split(' ')[0])}</span>
          </div>
        </div>
      </a>
    `.trim();
  };

  const renderRankItem = (p, i) => {
    const dom = p.domain || 'source';
    return `
      <a class="rankItem" href="${p.link}" aria-label="${escapeHtml(p.title)}">
        <div class="rankNo">${i+1}</div>
        <div style="min-width:0">
          <p class="rankTitle">${escapeHtml(p.title)}</p>
          <div style="margin-top:6px;color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
            ${escapeHtml(dom)} ãƒ» ${escapeHtml(relTime(p.date))}
          </div>
        </div>
      </a>
    `.trim();
  };

  const apply = () => {
    const kw = (q.value || '').trim().toLowerCase();
    let filtered = all;

    if(tab !== 'all'){
      filtered = filtered.filter(p => p.cat === tab);
    }
    if(kw){
      filtered = filtered.filter(p => p.title.toLowerCase().includes(kw));
    }

    view = filtered;
    cursor = 0;
    list.innerHTML = '';
    empty.style.display = 'none';

    filterTag.textContent = tab.toUpperCase();
    loadMore();

    if(!view.length){
      empty.style.display = 'block';
      status.textContent = `è¡¨ç¤ºä¸­: 0ä»¶ / å…¨${all.length}ä»¶`;
      moreBtn.disabled = true;
    }
  };

  const loadMore = () => {
    const slice = view.slice(cursor, cursor + PAGE_SIZE);
    list.insertAdjacentHTML('beforeend', slice.map(renderCard).join(''));
    cursor += slice.length;

    status.textContent = `è¡¨ç¤ºä¸­: ${cursor}ä»¶ / å…¨${all.length}ä»¶`;
    moreBtn.disabled = cursor >= view.length;
    moreBtn.textContent = cursor >= view.length ? 'ã“ã‚Œä»¥ä¸Šã‚ã‚Šã¾ã›ã‚“' : 'ã‚‚ã£ã¨è¦‹ã‚‹';
  };

  const setTab = (next) => {
    tab = next;
    tabs.forEach(b => b.setAttribute('aria-pressed', b.dataset.tab === next ? 'true' : 'false'));
    apply();
  };

  const renderRank = () => {
    const top = [...all]
      .sort((a,b)=>scoreHot(b)-scoreHot(a))
      .slice(0, 6);
    rank.innerHTML = top.map(renderRankItem).join('');
  };

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è‡ªå‹•èª­ã¿è¾¼ã¿ï¼ˆç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é¢¨ï¼‰
  const onScroll = () => {
    if(moreBtn.disabled) return;
    const y = window.scrollY + window.innerHeight;
    const h = document.documentElement.scrollHeight;
    if(h - y < 420){
      loadMore();
    }
  };

  const bind = () => {
    reloadBtn.addEventListener('click', load);
    moreBtn.addEventListener('click', loadMore);
    q.addEventListener('input', apply);
    tabs.forEach(b => b.addEventListener('click', () => setTab(b.dataset.tab)));
    window.addEventListener('scroll', onScroll, { passive:true });
  };

  async function load(){
    status.textContent = 'èª­ã¿è¾¼ã¿ä¸­â€¦';
    moreBtn.disabled = true;

    try{
      const res = await fetch(POSTS_URL + '?t=' + Date.now(), { cache:'no-store' });
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const json = await res.json();

      all = normalize(json);
      countMini.textContent = `${all.length}ä»¶`;
      subline.textContent = all[0]?.date ? `æœ€çµ‚æ›´æ–°ï¼š${fmtJP(all[0].date)}` : 'RSSè‡ªå‹•åé›†ï¼ˆèª­ã¿å–ã‚Šç”¨ï¼‰';
      updated.textContent = all[0]?.date ? `æ›´æ–°: ${fmtJP(all[0].date)}` : 'æ›´æ–°: â€”';

      renderRank();
      apply();
      moreBtn.disabled = false;

      if(!all.length){
        empty.style.display = 'block';
        status.textContent = 'è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆposts.jsonãŒç©ºã‹ã‚‚ï¼‰';
      }
    }catch(e){
      status.textContent = `èª­ã¿è¾¼ã¿å¤±æ•—: ${e.message} | posts.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„/å£Šã‚Œã¦ã‚‹å¯èƒ½æ€§`;
      empty.style.display = 'block';
      empty.textContent = 'posts.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€JSONå½¢å¼ãŒå£Šã‚Œã¦ã„ã¾ã™ã€‚';
      moreBtn.disabled = true;
    }
  }

  bind();
  load();
})();
</script>
</body>
</html>
