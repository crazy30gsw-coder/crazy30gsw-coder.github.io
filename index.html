<!doctype html>
<!-- ID: INDEX-JINLIKE-NEWS-THREADS-20260115-V2 -->
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã¾ã¨ã‚é€Ÿå ±ï½œèŠ¸èƒ½ãƒ»æ”¿æ²»ãƒ»è©±é¡Œ</title>
  <meta name="description" content="èŠ¸èƒ½ãƒ»æ”¿æ²»ãƒ»è©±é¡Œãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼‹æ²ç¤ºæ¿é¢¨ã¾ã¨ã‚ã‚’è¦‹ã‚„ã™ãæ•´ç†" />
  <meta name="theme-color" content="#ffffff" />

  <!-- AdSense -->
  <!-- ID: ADSENSE-HEAD-CA-PUB-33000575674917758 -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-33000575674917758"
    crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --line:#e6e6e6;
      --brand:#ff5a00;
      --brand2:#111;
      --shadow:0 10px 22px rgba(0,0,0,.06);
      --radius:14px;
      --max: 1100px;
      --side: 340px;
      --link:#0b57d0;
      --tagbg:#fff3e6;
      --tagbd:#ffd2a8;
      --tagtx:#7a2f00;
      --bbsbg:#f7f7f8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}

    /* topbar */
    .topbar{background:#111;color:#fff;font-size:12px}
    .topbar .wrap{
      max-width:var(--max);margin:0 auto;padding:8px 12px;
      display:flex;gap:10px;align-items:center;justify-content:space-between;
    }
    .topbar .mini a{color:#fff;opacity:.85;font-weight:900}
    .topbar .mini a:hover{opacity:1;text-decoration:none}

    /* header */
    header{background:#fff;border-bottom:2px solid var(--brand);position:sticky;top:0;z-index:20}
    header .wrap{
      max-width:var(--max);margin:0 auto;padding:12px 12px;
      display:flex;align-items:center;gap:12px;flex-wrap:wrap;
    }
    .logo{display:flex;align-items:center;gap:10px;min-width:0}
    .mark{
      width:40px;height:40px;border-radius:10px;
      background:linear-gradient(135deg,#ff7a00,#ff3b00);
      display:grid;place-items:center;color:#fff;font-weight:1000;
      box-shadow:0 8px 18px rgba(255,90,0,.22);flex:0 0 auto;
    }
    .titlebox{min-width:0}
    .title{
      font-size:20px;font-weight:1000;letter-spacing:.02em;line-height:1.1;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .sub{
      margin-top:4px;color:var(--muted);font-size:12px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
    }
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      border:1px solid var(--line);background:#fafafa;padding:6px 10px;
      border-radius:999px;font-weight:1000;font-size:12px;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--brand)}
    .actions{margin-left:auto;display:flex;gap:8px}
    button{
      appearance:none;border:1px solid var(--line);background:#fff;color:#111;
      padding:10px 12px;border-radius:12px;font-weight:1000;font-size:13px;
      box-shadow:0 6px 14px rgba(0,0,0,.05);cursor:pointer;
    }
    button:active{transform:translateY(1px)}

    /* nav */
    .nav{
      max-width:var(--max);margin:0 auto;padding:0 12px 10px;
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }
    .chip{
      border:1px solid var(--line);background:#fff;
      padding:9px 12px;border-radius:999px;font-size:13px;font-weight:1000;
      cursor:pointer;user-select:none;
    }
    .chip.active{background:var(--brand2);color:#fff;border-color:var(--brand2)}

    /* layout */
    main{padding:12px 0 30px}
    .layout{
      max-width:var(--max);margin:0 auto;padding:0 12px;
      display:grid;grid-template-columns:1fr;gap:14px;
    }
    @media(min-width:980px){
      .layout{grid-template-columns: 1fr var(--side);align-items:start}
    }

    .panel{
      background:#fff;border:1px solid var(--line);border-radius:var(--radius);
      box-shadow:var(--shadow);overflow:hidden;
    }
    .panel-hd{
      padding:12px 12px;border-bottom:1px solid var(--line);
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      flex-wrap:wrap;background:linear-gradient(180deg,#fff,#fafafa);
    }
    .panel-hd b{font-weight:1000}
    .panel-hd small{color:var(--muted);font-weight:900}

    .search{
      margin:10px 12px 12px;
      display:flex;align-items:center;gap:10px;
      border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#fff;
    }
    .search input{width:100%;border:0;outline:0;font-size:14px}

    /* news list */
    .list{display:flex;flex-direction:column;gap:10px;padding:12px}
    .card{
      display:flex;gap:12px;padding:12px;border:1px solid var(--line);
      border-radius:14px;background:#fff;cursor:pointer;transition:transform .05s ease;
    }
    .card:active{transform:translateY(1px)}
    .thumb{
      width:120px;height:78px;border-radius:12px;overflow:hidden;background:#f2f2f2;
      flex:0 0 auto;position:relative;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .timebadge{
      position:absolute;left:8px;top:8px;background:rgba(17,17,17,.82);color:#fff;
      padding:5px 8px;border-radius:999px;font-size:11px;font-weight:1000;
      backdrop-filter:blur(6px);
    }
    .body{min-width:0;flex:1}
    .headline{
      margin:0;font-size:16px;font-weight:1000;line-height:1.28;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
    }
    .headline a{color:#111}
    .meta{
      margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;
      font-size:12px;color:var(--muted);
    }
    .tag{
      display:inline-flex;align-items:center;
      padding:5px 10px;border-radius:999px;background:var(--tagbg);
      border:1px solid var(--tagbd);color:var(--tagtx);font-weight:1000;
    }
    .src{
      display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;
      background:#fff;border:1px solid var(--line);font-weight:900;color:#111;
    }
    .src b{color:#111}
    .empty{padding:18px 12px;color:var(--muted);font-size:14px}

    /* sidebar */
    .side .panel + .panel{margin-top:14px}
    .side .panel-hd{background:#111;color:#fff;border-bottom:0}
    .side .panel-hd small{color:rgba(255,255,255,.85)}
    .side .box{
      padding:10px 12px 12px;display:flex;flex-direction:column;gap:10px;
    }
    .mini{
      display:flex;gap:10px;align-items:flex-start;padding:10px;
      border:1px solid var(--line);border-radius:14px;background:#fff;
    }
    .rank{
      width:26px;height:26px;border-radius:10px;background:#111;color:#fff;
      display:grid;place-items:center;font-weight:1000;flex:0 0 auto;font-size:13px;
    }
    .mini a{
      color:#111;font-weight:1000;line-height:1.35;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
    }
    .mini .m{
      margin-top:4px;font-size:12px;color:var(--muted);
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }
    .adnote{font-size:11px;color:var(--muted)}
    .adframe{
      border:1px dashed #ddd;border-radius:14px;padding:12px;background:#fff;text-align:center;
      color:#999;font-weight:1000;font-size:12px;
    }

    /* ===== BBS block (ã“ã“ãŒè¿½åŠ ) ===== */
    .bbswrap{padding:12px}
    .bbsbox{
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--bbsbg);
      overflow:hidden;
    }
    .bbshead{
      padding:12px 12px;
      background:#fff;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .bbshead b{font-weight:1000}
    .bbshead small{color:var(--muted);font-weight:900}
    .thread{
      padding:12px;
      display:flex;
      gap:12px;
      border-top:1px solid var(--line);
      background:linear-gradient(180deg,#fff,#fbfbfb);
      cursor:pointer;
    }
    .thread:first-child{border-top:0}
    .hot{
      width:44px;height:44px;border-radius:14px;
      background:#111;color:#fff;
      display:grid;place-items:center;
      font-weight:1000;
      flex:0 0 auto;
      font-size:12px;
    }
    .tmeta{min-width:0;flex:1}
    .ttitle{
      font-size:15px;font-weight:1000;line-height:1.3;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
      margin:0;
    }
    .tinfo{
      margin-top:6px;
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
      font-size:12px;color:var(--muted);
    }
    .board{
      display:inline-flex;align-items:center;
      padding:4px 10px;border-radius:999px;
      background:#fff;border:1px solid var(--line);
      font-weight:900;color:#111;
    }
    .quotes{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .quote{
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:8px 10px;
      font-size:13px;
      line-height:1.5;
      color:#111;
    }
    .qno{color:#999;font-weight:900;margin-right:6px}
    .qlike{color:#999;font-size:12px;margin-left:6px}

    /* footer */
    footer{
      max-width:var(--max);margin:18px auto 0;padding:0 12px 26px;
      color:var(--muted);font-size:12px;line-height:1.7;
    }
    footer .footbox{
      border-top:1px solid var(--line);padding-top:14px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    footer a{color:#444;font-weight:1000}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div>æœ€æ–°ã¾ã¨ã‚ï½œãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼‹æ²ç¤ºæ¿é¢¨ã¾ã¨ã‚</div>
      <div class="mini">
        <a href="./privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a>
        <span style="opacity:.5;margin:0 8px;">|</span>
        <a href="./contact.html">ãŠå•ã„åˆã‚ã›</a>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap">
      <div class="logo">
        <div class="mark">é€Ÿ</div>
        <div class="titlebox">
          <div class="title">ã¾ã¨ã‚é€Ÿå ±</div>
          <div class="sub">
            <span class="pill"><span class="dot"></span><span id="statText">èª­ã¿è¾¼ã¿ä¸­â€¦</span></span>
            <span class="pill">æ›´æ–°: <span id="updatedAt">-</span></span>
            <span class="pill">ãƒ‹ãƒ¥ãƒ¼ã‚¹ <span id="totalTop">0</span>ä»¶</span>
            <span class="pill">æ²ç¤ºæ¿ <span id="threadTop">0</span>ä»¶</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="reloadBtn" type="button">å†èª­ã¿è¾¼ã¿</button>
      </div>
    </div>

    <div class="nav">
      <div class="chip active" data-filter="all">ãƒˆãƒƒãƒ—</div>
      <div class="chip" data-filter="èŠ¸èƒ½">èŠ¸èƒ½</div>
      <div class="chip" data-filter="ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«">ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«</div>
      <div class="chip" data-filter="æ”¿æ²»">æ”¿æ²»</div>
      <div class="chip" data-filter="ãã®ä»–">ãã®ä»–</div>
    </div>
  </header>

  <main>
    <div class="layout">
      <!-- Main -->
      <section class="panel">
        <div class="panel-hd">
          <div><b>æœ€æ–°è¨˜äº‹</b></div>
          <small>è¡¨ç¤º: <b id="shown">0</b> / å…¨ <b id="total">0</b></small>
        </div>

        <div class="search" role="search" aria-label="æ¤œç´¢">
          ğŸ” <input id="q" type="search" placeholder="æ¤œç´¢ï¼ˆä¾‹ï¼šç‚ä¸Šã€çµå©šã€é€®æ•ã€ç·ç†ã€é¸æŒ™ï¼‰" />
        </div>

        <div class="list" id="list"></div>
        <div class="empty" id="empty" style="display:none;">è©²å½“ã™ã‚‹è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>

        <!-- ===== æ²ç¤ºæ¿ã¾ã¨ã‚æ ï¼ˆã“ã“ãŒè¿½åŠ ï¼‰ ===== -->
        <div class="bbswrap">
          <div class="bbsbox">
            <div class="bbshead">
              <b>æ²ç¤ºæ¿ã¾ã¨ã‚</b>
              <small>â€» çŸ­ã„å¼•ç”¨ï¼‹ãƒªãƒ³ã‚¯ï¼ˆè»¢è¼‰ã—ãªã„ï¼‰</small>
            </div>
            <div id="threads"></div>
          </div>
        </div>
      </section>

      <!-- Side -->
      <aside class="side">
        <section class="panel">
          <div class="panel-hd">
            <b>äººæ°—è¨˜äº‹</b>
            <small>ã‚¯ãƒªãƒƒã‚¯æ•°</small>
          </div>
          <div class="box" id="popular"></div>
        </section>

        <section class="panel">
          <div class="panel-hd">
            <b>é–¢é€£è¨˜äº‹</b>
            <small>ç›´è¿‘å‚¾å‘</small>
          </div>
          <div class="box" id="related"></div>
        </section>

        <section class="panel">
          <div class="panel-hd">
            <b>åºƒå‘Š</b>
            <small>AdSense</small>
          </div>
          <div class="box">
            <div class="adnote">â€» å¯©æŸ»é€šéå¾Œã€è‡ªå‹•åºƒå‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            <div class="adframe">AdSenseï¼ˆè‡ªå‹•åºƒå‘Šï¼‰è¡¨ç¤ºã‚¨ãƒªã‚¢</div>
          </div>
        </section>

        <section class="panel">
          <div class="panel-hd">
            <b>ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</b>
            <small>æ³¨æ„</small>
          </div>
          <div class="box" style="color:var(--muted);font-size:12px;line-height:1.7;">
            å½“ã‚µã‚¤ãƒˆã¯RSSç­‰ã‹ã‚‰å–å¾—ã—ãŸæƒ…å ±ã‚’æ•´ç†ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚<br>
            æ²ç¤ºæ¿ã¾ã¨ã‚ã¯çŸ­ã„å¼•ç”¨ï¼‹ãƒªãƒ³ã‚¯ä¸­å¿ƒã§ã€å…ƒãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
          </div>
        </section>
      </aside>
    </div>
  </main>

  <footer>
    <div class="wrap">
      <div class="footbox">
        <div>â€» RSSç­‰ã®æƒ…å ±ã‚’æ•´ç†ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ï¼ˆå…ƒè¨˜äº‹å‚ç…§ï¼‰ã€‚</div>
        <div>
          <a href="./privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
          <span style="margin:0 8px;">|</span>
          <a href="./contact.html">ãŠå•ã„åˆã‚ã›</a>
        </div>
      </div>
    </div>
  </footer>

<script>
  // =========================
  // ID: CONFIG
  // =========================
  const POSTS_URL = "./posts.json";
  const THREADS_URL = "./threads.json";
  const CLICK_KEY = "ms_clicks_v1";
  const MAX_POPULAR = 8;
  const MAX_RELATED = 8;

  // =========================
  // ID: UTIL
  // =========================
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));

  function safeHost(url){
    try{ return new URL(url).hostname.replace(/^www\./,''); }catch(e){ return ''; }
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }
  function fmtDate(iso){
    try{
      const d = new Date(iso);
      const y=d.getFullYear();
      const m=String(d.getMonth()+1).padStart(2,'0');
      const day=String(d.getDate()).padStart(2,'0');
      const hh=String(d.getHours()).padStart(2,'0');
      const mm=String(d.getMinutes()).padStart(2,'0');
      return `${y}/${m}/${day} ${hh}:${mm}`;
    }catch(e){ return iso || "-"; }
  }
  function timeAgo(iso){
    try{
      const t=new Date(iso).getTime();
      const diff=Date.now()-t;
      const min=Math.floor(diff/60000);
      if(min<1) return "ãŸã£ãŸä»Š";
      if(min<60) return `${min}åˆ†å‰`;
      const h=Math.floor(min/60);
      if(h<24) return `${h}æ™‚é–“å‰`;
      const d=Math.floor(h/24);
      return `${d}æ—¥å‰`;
    }catch(e){ return ""; }
  }

  function labelOfCategory(c){
    if(c==="èŠ¸èƒ½") return "èŠ¸èƒ½";
    if(c==="æ”¿æ²»") return "æ”¿æ²»";
    if(c==="ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«") return "ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«";
    return "ãã®ä»–";
  }

  function keywords(title){
    const t=(title||"")
      .replace(/[ã€ã€‘\[\]ï¼ˆï¼‰()ã€Œã€ã€ã€ã€ã€‚ãƒ»:ï¼š!?ï¼ï¼Ÿâ€¦]/g," ")
      .replace(/\s+/g," ")
      .trim();
    const raw=t.split(" ").filter(Boolean);
    const stop=new Set(["ã¾ã¨ã‚","é€Ÿå ±","ãƒ‹ãƒ¥ãƒ¼ã‚¹","èŠ¸èƒ½","æ”¿æ²»","è©±é¡Œ","å‹•ç”»","ç”»åƒ","æœ€æ–°","ç™ºè¡¨","å ±é“"]);
    return raw.map(x=>x.toLowerCase()).filter(x=>x.length>=2 && !stop.has(x));
  }

  // =========================
  // ID: CLICK-TRACK
  // =========================
  function loadClicks(){
    try{ return JSON.parse(localStorage.getItem(CLICK_KEY)||"{}"); }catch(e){ return {}; }
  }
  function saveClicks(obj){
    try{ localStorage.setItem(CLICK_KEY, JSON.stringify(obj)); }catch(e){}
  }
  function addClick(url){
    const c=loadClicks();
    const k=url||"";
    c[k]=(c[k]||0)+1;
    saveClicks(c);
  }

  // =========================
  // ID: STATE
  // =========================
  let ALL=[];
  let THREADS=[];
  let filter="all";

  // =========================
  // ID: NEWS RENDER
  // =========================
  function buildCard(p){
    const art=document.createElement("article");
    art.className="card";

    const thumb=document.createElement("div");
    thumb.className="thumb";
    const img=document.createElement("img");
    img.loading="lazy";
    img.src=p.image || "https://via.placeholder.com/560x320?text=NO+IMAGE";
    img.alt=p.title || "";
    img.onerror=()=>{ img.src="https://via.placeholder.com/560x320?text=NO+IMAGE"; };
    const badge=document.createElement("div");
    badge.className="timebadge";
    badge.textContent=timeAgo(p.date);
    thumb.appendChild(img);
    thumb.appendChild(badge);

    const body=document.createElement("div");
    body.className="body";

    const h=document.createElement("h2");
    h.className="headline";
    const a=document.createElement("a");
    a.href=p.url;
    a.target="_blank";
    a.rel="noopener noreferrer";
    a.textContent=p.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)";
    a.addEventListener("click", ()=>addClick(p.url));
    h.appendChild(a);

    const meta=document.createElement("div");
    meta.className="meta";

    const tag=document.createElement("span");
    tag.className="tag";
    tag.textContent=labelOfCategory(p.category);

    const src=document.createElement("span");
    src.className="src";
    src.innerHTML=`<b>â—</b> ${escapeHtml(p.source || safeHost(p.url) || "source")}`;

    const t=document.createElement("span");
    t.textContent=fmtDate(p.date);

    meta.appendChild(tag);
    meta.appendChild(src);
    meta.appendChild(t);

    body.appendChild(h);
    body.appendChild(meta);

    art.appendChild(thumb);
    art.appendChild(body);

    art.addEventListener("click",(e)=>{
      if(e.target && e.target.tagName==="A") return;
      addClick(p.url);
      window.open(p.url, "_blank", "noopener,noreferrer");
    });

    return art;
  }

  function render(){
    const q = ($("#q").value||"").trim().toLowerCase();
    const list=$("#list");
    list.innerHTML="";

    let items=ALL.slice();
    if(filter!=="all") items=items.filter(p=>p.category===filter);

    if(q){
      items=items.filter(p=>{
        const hay=((p.title||"")+" "+(p.source||"")+" "+(p.url||"")).toLowerCase();
        return hay.includes(q);
      });
    }

    $("#shown").textContent=String(items.length);
    $("#total").textContent=String(ALL.length);
    $("#totalTop").textContent=String(ALL.length);

    if(!items.length){
      $("#empty").style.display="block";
    }else{
      $("#empty").style.display="none";
      const frag=document.createDocumentFragment();
      items.forEach(p=>frag.appendChild(buildCard(p)));
      list.appendChild(frag);
    }

    renderPopular();
    renderRelated();
    renderThreads();
  }

  // =========================
  // ID: POPULAR / RELATED
  // =========================
  function renderPopular(){
    const box=$("#popular");
    box.innerHTML="";
    const clicks=loadClicks();

    const scored=ALL.map(p=>({p, score:(clicks[p.url]||0)})).sort((a,b)=>b.score-a.score);
    const use=(scored[0]?.score>0) ? scored.slice(0,MAX_POPULAR).map(x=>x.p) : ALL.slice(0,MAX_POPULAR);

    use.forEach((p,i)=>{
      const row=document.createElement("div");
      row.className="mini";
      row.innerHTML=`
        <div class="rank">${i+1}</div>
        <div style="min-width:0">
          <a href="${p.url}" target="_blank" rel="noopener noreferrer">${escapeHtml(p.title||"(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)")}</a>
          <div class="m">
            <span class="tag">${labelOfCategory(p.category)}</span>
            <span>${escapeHtml(p.source||safeHost(p.url)||"source")}</span>
          </div>
        </div>
      `;
      row.querySelector("a").addEventListener("click", ()=>addClick(p.url));
      box.appendChild(row);
    });
  }

  function renderRelated(){
    const box=$("#related");
    box.innerHTML="";
    const recent=ALL.slice(0,10);
    const pool=ALL.slice(0,60);

    const freq=new Map();
    recent.forEach(p=>keywords(p.title).forEach(k=>freq.set(k,(freq.get(k)||0)+1)));
    const topKeys=Array.from(freq.entries()).sort((a,b)=>b[1]-a[1]).slice(0,6).map(x=>x[0]);

    const scored=pool.map(p=>{
      const ks=keywords(p.title);
      let s=0; topKeys.forEach(k=>{ if(ks.includes(k)) s+=2; });
      if(p.category==="èŠ¸èƒ½") s+=1;
      return {p,s};
    }).sort((a,b)=>b.s-a.s);

    const use = scored.filter(x=>x.s>0).slice(0,MAX_RELATED).map(x=>x.p);
    const finalUse = use.length ? use : ALL.slice(0,MAX_RELATED);

    finalUse.forEach((p,i)=>{
      const row=document.createElement("div");
      row.className="mini";
      row.innerHTML=`
        <div class="rank">${i+1}</div>
        <div style="min-width:0">
          <a href="${p.url}" target="_blank" rel="noopener noreferrer">${escapeHtml(p.title||"(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)")}</a>
          <div class="m">
            <span class="tag">${labelOfCategory(p.category)}</span>
            <span>${escapeHtml(p.source||safeHost(p.url)||"source")}</span>
          </div>
        </div>
      `;
      row.querySelector("a").addEventListener("click", ()=>addClick(p.url));
      box.appendChild(row);
    });
  }

  // =========================
  // ID: THREADS (æ²ç¤ºæ¿ã¾ã¨ã‚é¢¨)
  // =========================
  function renderThreads(){
    const box = $("#threads");
    box.innerHTML = "";

    $("#threadTop").textContent = String(THREADS.length);

    const frag = document.createDocumentFragment();
    THREADS.slice(0, 8).forEach(th=>{
      const row = document.createElement("div");
      row.className = "thread";
      row.addEventListener("click", ()=>{
        // æ²ç¤ºæ¿ã¾ã¨ã‚å´ã‚‚ã‚¯ãƒªãƒƒã‚¯æ•°ã«åŠ ç®—
        addClick(th.url);
        window.open(th.url, "_blank", "noopener,noreferrer");
      });

      const hot = document.createElement("div");
      hot.className = "hot";
      hot.textContent = "HOT\n" + String(th.hot ?? 0);

      const meta = document.createElement("div");
      meta.className = "tmeta";

      const h = document.createElement("p");
      h.className = "ttitle";
      h.textContent = th.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)";

      const info = document.createElement("div");
      info.className = "tinfo";
      info.innerHTML = `
        <span class="board">${escapeHtml(th.board || "æ²ç¤ºæ¿")}</span>
        <span>${fmtDate(th.date)}</span>
        <span>${timeAgo(th.date)}</span>
      `;

      const quotes = document.createElement("div");
      quotes.className = "quotes";

      (th.posts || []).slice(0, 3).forEach(p=>{
        const q = document.createElement("div");
        q.className = "quote";
        q.innerHTML = `<span class="qno">#${p.no ?? ""}</span>${escapeHtml(p.text || "")}
          <span class="qlike">â˜…${p.likes ?? 0}</span>`;
        quotes.appendChild(q);
      });

      meta.appendChild(h);
      meta.appendChild(info);
      meta.appendChild(quotes);

      row.appendChild(hot);
      row.appendChild(meta);
      frag.appendChild(row);
    });

    box.appendChild(frag);
  }

  // =========================
  // ID: LOAD
  // =========================
  async function load(){
    $("#statText").textContent="èª­ã¿è¾¼ã¿ä¸­â€¦";

    try{
      // NEWS
      const r1 = await fetch(POSTS_URL + "?v=" + Date.now(), {cache:"no-store"});
      if(!r1.ok) throw new Error("posts.json HTTP " + r1.status);
      const data1 = await r1.json();

      let posts=[], updatedAt=null;
      if(Array.isArray(data1)){
        posts=data1;
      }else{
        posts=data1.posts || [];
        updatedAt=data1.updatedAt || null;
      }

      ALL = posts.map(p=>{
        const url = p.url || p.link || "";
        return {
          title: p.title || "",
          url,
          source: p.source || safeHost(url) || "",
          date: p.date || p.published || p.pubDate || new Date().toISOString(),
          image: p.image || p.ogImage || p.thumbnail || "",
          category: p.category || "ãã®ä»–"
        };
      }).filter(p=>!!p.url).sort((a,b)=>new Date(b.date)-new Date(a.date));

      $("#updatedAt").textContent = updatedAt ? fmtDate(updatedAt) : (ALL[0]?.date ? fmtDate(ALL[0].date) : "-");

      // THREADS
      try{
        const r2 = await fetch(THREADS_URL + "?v=" + Date.now(), {cache:"no-store"});
        if(!r2.ok) throw new Error("threads.json HTTP " + r2.status);
        const data2 = await r2.json();
        THREADS = (data2.threads || data2 || []).map(t=>({
          title: t.title || "",
          url: t.url || "",
          board: t.board || "æ²ç¤ºæ¿",
          date: t.date || new Date().toISOString(),
          hot: t.hot ?? 0,
          posts: Array.isArray(t.posts) ? t.posts : []
        })).filter(t=>!!t.url).sort((a,b)=>new Date(b.date)-new Date(a.date));
      }catch(e){
        THREADS = [];
      }

      $("#statText").textContent="ç¨¼åƒä¸­";

      // åˆå›ã¯ãƒˆãƒƒãƒ—
      filter="all";
      $$(".chip").forEach(c=>c.classList.remove("active"));
      document.querySelector('.chip[data-filter="all"]').classList.add("active");

      render();
    }catch(e){
      console.error(e);
      $("#statText").textContent="èª­ã¿è¾¼ã¿å¤±æ•—";
      $("#list").innerHTML="";
      $("#popular").innerHTML="";
      $("#related").innerHTML="";
      $("#threads").innerHTML="";
      $("#empty").style.display="block";
      $("#empty").textContent="èª­ã¿è¾¼ã¿å¤±æ•—: posts.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹å£Šã‚Œã¦ã¾ã™";
    }
  }

  // =========================
  // ID: EVENTS
  // =========================
  $("#reloadBtn").addEventListener("click", ()=>{
    $("#q").value="";
    load();
  });

  $("#q").addEventListener("input", render);

  $$(".chip").forEach(ch=>{
    ch.addEventListener("click", ()=>{
      $$(".chip").forEach(x=>x.classList.remove("active"));
      ch.classList.add("active");
      filter = ch.getAttribute("data-filter") || "all";
      render();
    });
  });

  load();
</script>
</body>
</html>